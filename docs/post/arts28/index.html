<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>ARTS28 | 林华清</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Algorithm 剑指 Offer 05. 替换空格 func replaceSpace(s string) string { builder := strings.Builder{} for _, rune1 := range s { if rune1 != &#39; &#39; { builder.WriteRune(rune1) } else { builder.WriteString(&quot;%20&quot;) } } return builder.String() } Review Best practices to communicate between microservices 文章标题党，主要讲了怎么用C#发布和消费基于RabbitMQ的异步事件消息，内容比较简单。
作者的一个观点是微服务之间应该尽量都用异步消息来通讯，这个我是不认同的。大部分RPC调用还是同步堵塞型的，比较可控而且client能够及时根据response结果进行后续的正常或者异常逻辑处理。
TIP 这周工作过程中需要建立一个grafana大盘，数据来源是ES。先来简单看下ES数据的数据格式：
CpuRateAvg | QPS | Date | ServiceName 0.3 | 1000 | 2021-11-07T00:00:00.000Z | Service_A 0.4 | 2000 | 2021-11-08T00:00:00.000Z | Service_A 0.3 | 1000 | 2021-11-07T00:00:00.">
    <meta name="generator" content="Hugo 0.85.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >




    
      

    

    
    
    <meta property="og:title" content="ARTS28" />
<meta property="og:description" content="Algorithm 剑指 Offer 05. 替换空格 func replaceSpace(s string) string { builder := strings.Builder{} for _, rune1 := range s { if rune1 != &#39; &#39; { builder.WriteRune(rune1) } else { builder.WriteString(&quot;%20&quot;) } } return builder.String() } Review Best practices to communicate between microservices 文章标题党，主要讲了怎么用C#发布和消费基于RabbitMQ的异步事件消息，内容比较简单。
作者的一个观点是微服务之间应该尽量都用异步消息来通讯，这个我是不认同的。大部分RPC调用还是同步堵塞型的，比较可控而且client能够及时根据response结果进行后续的正常或者异常逻辑处理。
TIP 这周工作过程中需要建立一个grafana大盘，数据来源是ES。先来简单看下ES数据的数据格式：
CpuRateAvg | QPS | Date | ServiceName 0.3 | 1000 | 2021-11-07T00:00:00.000Z | Service_A 0.4 | 2000 | 2021-11-08T00:00:00.000Z | Service_A 0.3 | 1000 | 2021-11-07T00:00:00." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://linhuaqing0928.github.io/post/arts28/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-09T23:33:57+08:00" />
<meta property="article:modified_time" content="2022-01-09T23:33:57+08:00" />

<meta itemprop="name" content="ARTS28">
<meta itemprop="description" content="Algorithm 剑指 Offer 05. 替换空格 func replaceSpace(s string) string { builder := strings.Builder{} for _, rune1 := range s { if rune1 != &#39; &#39; { builder.WriteRune(rune1) } else { builder.WriteString(&quot;%20&quot;) } } return builder.String() } Review Best practices to communicate between microservices 文章标题党，主要讲了怎么用C#发布和消费基于RabbitMQ的异步事件消息，内容比较简单。
作者的一个观点是微服务之间应该尽量都用异步消息来通讯，这个我是不认同的。大部分RPC调用还是同步堵塞型的，比较可控而且client能够及时根据response结果进行后续的正常或者异常逻辑处理。
TIP 这周工作过程中需要建立一个grafana大盘，数据来源是ES。先来简单看下ES数据的数据格式：
CpuRateAvg | QPS | Date | ServiceName 0.3 | 1000 | 2021-11-07T00:00:00.000Z | Service_A 0.4 | 2000 | 2021-11-08T00:00:00.000Z | Service_A 0.3 | 1000 | 2021-11-07T00:00:00."><meta itemprop="datePublished" content="2022-01-09T23:33:57+08:00" />
<meta itemprop="dateModified" content="2022-01-09T23:33:57+08:00" />
<meta itemprop="wordCount" content="189">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ARTS28"/>
<meta name="twitter:description" content="Algorithm 剑指 Offer 05. 替换空格 func replaceSpace(s string) string { builder := strings.Builder{} for _, rune1 := range s { if rune1 != &#39; &#39; { builder.WriteRune(rune1) } else { builder.WriteString(&quot;%20&quot;) } } return builder.String() } Review Best practices to communicate between microservices 文章标题党，主要讲了怎么用C#发布和消费基于RabbitMQ的异步事件消息，内容比较简单。
作者的一个观点是微服务之间应该尽量都用异步消息来通讯，这个我是不认同的。大部分RPC调用还是同步堵塞型的，比较可控而且client能够及时根据response结果进行后续的正常或者异常逻辑处理。
TIP 这周工作过程中需要建立一个grafana大盘，数据来源是ES。先来简单看下ES数据的数据格式：
CpuRateAvg | QPS | Date | ServiceName 0.3 | 1000 | 2021-11-07T00:00:00.000Z | Service_A 0.4 | 2000 | 2021-11-08T00:00:00.000Z | Service_A 0.3 | 1000 | 2021-11-07T00:00:00."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        林华清
      
    </a>
    <div class="flex-l items-center">
      

      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=http://linhuaqing0928.github.io/post/arts28/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=http://linhuaqing0928.github.io/post/arts28/&amp;text=ARTS28" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://linhuaqing0928.github.io/post/arts28/&amp;title=ARTS28" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">ARTS28</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2022-01-09T23:33:57+08:00">January 9, 2022</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><h2 id="algorithm">Algorithm</h2>
<h4 id="剑指-offer-05-替换空格httpsleetcode-cncomproblemsti-huan-kong-ge-lcof"><a href="https://leetcode-cn.com/problems/ti-huan-kong-ge-lcof/">剑指 Offer 05. 替换空格</a></h4>
<pre><code>func replaceSpace(s string) string {
	builder := strings.Builder{}
	for _, rune1 := range s {
		if rune1 != ' ' {
			builder.WriteRune(rune1)
		} else {
			builder.WriteString(&quot;%20&quot;)
		}
	}
	return builder.String()
}
</code></pre><h2 id="review">Review</h2>
<p><a href="https://irfanyusanif.medium.com/how-to-communicate-between-microservices-7956ed68a99a">Best practices to communicate between microservices</a>
文章标题党，主要讲了怎么用C#发布和消费基于RabbitMQ的异步事件消息，内容比较简单。</p>
<p>作者的一个观点是微服务之间应该尽量都用异步消息来通讯，这个我是不认同的。大部分RPC调用还是同步堵塞型的，比较可控而且client能够及时根据response结果进行后续的正常或者异常逻辑处理。</p>
<h2 id="tip">TIP</h2>
<p>这周工作过程中需要建立一个grafana大盘，数据来源是ES。先来简单看下ES数据的数据格式：</p>
<pre><code>CpuRateAvg | QPS | Date | ServiceName
0.3 | 1000 | 2021-11-07T00:00:00.000Z | Service_A
0.4 | 2000 | 2021-11-08T00:00:00.000Z | Service_A
0.3 | 1000 | 2021-11-07T00:00:00.000Z | Service_B
0.4 | 2000 | 2021-11-08T00:00:00.000Z | Service_B
</code></pre><p>现在想要在grafana大盘上，画出以下2个数据展示大盘：</p>
<ol>
<li>画折线图 其中X轴为时间 Y轴为CPU数值 并且以ServiceName为颗粒度，画出多条CPU折线图。</li>
<li>画折线图 其中X轴为时间 Y轴为QPS数值 并且以ServiceName为颗粒度，画出多条QPS折线图。</li>
</ol>
<p>同时因为service比较多，还需要能够维护一个全局变量ServiceName，在切换ServiceName的时候2个折线图能同时切换为同一个服务所属的折线图。</p>
<p>经过摸索，配置操作如下：</p>
<ol>
<li>在dashboard的Variables里面新建一个变量，Type为Query（也就是从ES数据中查询出具体有哪些ServiceName）。query内容为：{&ldquo;find&rdquo;:&ldquo;terms&rdquo;,&ldquo;field&rdquo;:&ldquo;ServiceName&rdquo;}。Data Source配置为ES索引对应的数据源，refresh配置为On Time Range Change。 这样子这个全局变量就是ES数据里面真实存在的服务名。</li>
<li>新建一个Panel。然后添加一个query1，Query里面的查询语句写上：ServiceName: $ServiceName 这个query的意思就是根据全局变量ServiceName当前的实参，从ES中查询出ServiceName== $ServiceName的数据。对应到关系型数据库的sql就是，select * from XXX where ServiceName = xxx</li>
<li>query1的metrics设置为Max、CpuRateAvg。然后添加2个group by设置，第一个为Terms、ServiceName，第二个为Date Histogram、Date。 这样子就能出现一个期望的CPU折线图了。</li>
<li>重复步骤2-3创建一个QPS折线图。</li>
</ol>
<h2 id="share">Share</h2>
<p>继续学习“操作系统32讲”</p>
<h3 id="l4-操作系统接口">L4 操作系统接口</h3>
<p>操作系统接口（system_call）概念定义：接口表现为函数调用，又由系统提供，所以称为系统调用。</p>
<p>POSIX：Portable Operating System Interface of Unix （IEEE制定的一个标准族）<a href="https://pubs.opengroup.org/onlinepubs/9699919799.2018edition/">POSIX</a></p>
<h3 id="l5-系统调用的实现">L5 系统调用的实现</h3>
<p>首先，应用层代码不应该能够随意访问内存的任意地址（包含操作系统所在的内存地址），不然会有内存安全问题（比如随意读取操作系统层面的缓存，拿到root密码等信息），但是应用层代码又要能够调用操作系统接口（system_call保存在操作系统的内容空间段）。这里引出2个问题：</p>
<ol>
<li>怎么能隔离开应用层代码和操作系统代码 保障内存安全？</li>
<li>隔离开之后，又怎么能让应用层代码能够成功调用system_call呢？</li>
</ol>
<h4 id="操作系统怎么隔离内存实现内存安全">操作系统怎么隔离内存，实现内存安全</h4>
<p>操作系统区分内核态和用户态：通过一种处理器“硬件设计”来区分。具体过程：</p>
<ol>
<li>操作系统启动过程，在head.s代码中会通过初始化GDT（段寄存器访问内存之前会先到GDT表里面去查表，拿到要执行的指令的具体内存地址）表来给所有内存标记上具体哪段内存是内核端（对应的DPL为0），哪段是用户段（对应的DPL为3）。</li>
<li>操作系统在取指执行的时候是根据CS：IP来决定去哪个内存块取指令执行的，而处理器的硬件设计用CS的最低两位来标识当前CPL：0代表内核态，3代表用户态。</li>
<li>处理器在执行CS：IP的时候会去检查CPL（Current Privilege Level CS的最低2位）和DPL（Descriptor Privilege Level 段寄存器去GDT表取实际指令内存的时候能拿到这个值） 只有DPL大于等于CPL，才能访问这块内存。操作系统在用户态和内核态之间切换的时候，实际上就是不断的切换当前CPL的值。而DPL是在一开始GDT初始化的时候就决定了是0（内核段）还是3（用户段）</li>
<li>最终表现出来的就是：内核态可以访问任何数据，用户态不能访问内核数据。</li>
</ol>
<h4 id="应用程序如何访问内核段地址">应用程序如何访问内核段地址</h4>
<p>硬件层面提供了“主动进入内核的方法”：通过中断指令int（int 0x80）</p>
<ol>
<li>int指令将使CS中的CPL改为0，“进入内核”</li>
<li>这是用户程序发起调用内核代码的唯一方式。</li>
</ol>
<p>所以系统调用的核心其实就是：</p>
<ol>
<li>用户程序中包含一段int指令的代码</li>
<li>操作系统写中断处理，获取想调程序的编号</li>
<li>操作系统根据编号执行相应代码。</li>
</ol>
<p>在从printf(&hellip;)应用层代码来看，实际上就是</p>
<pre><code>#include &lt;unistd.h&gt;
_syscall3(int, write, int, fd, const char *buf, off_t, count)
#define _syscall3(type, name,...) type
name(...) \
{ __asm__ (&quot;int 0x80&quot; : &quot;=a&quot;(__res)...}
</code></pre><p>这里的C代码，看不太懂 大概意思就是将一个系统调用号(__NR__write 用来区分是哪个操作系统系统接口来调用的)置给eax寄存器，然后调用int 0x80。调用int 0x80之后就能进入内核。</p>
<h5 id="int-0x80中断的处理">int 0x80中断的处理</h5>
<p>int 0x80做了啥：去IDT表查询要处理的中断处理函数地址 然后跳过去</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://linhuaqing0928.github.io/" >
    &copy;  林华清 2022 
  </a>
    <div>














</div>
  </div>
</footer>

  </body>
</html>
